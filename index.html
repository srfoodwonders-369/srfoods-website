<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SR FOOD'S</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<!-- Razorpay -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
/* ===== Base ===== */
* { margin:0; padding:0; box-sizing:border-box; font-family: 'Roboto', sans-serif; }
body { background:#f8f8f8; color:#333; }
header { background:#fc8019; color:white; padding:15px; font-size:22px; font-weight:700; text-align:center; position:sticky; top:0; z-index:10; }

/* ===== Container ===== */
.container { max-width:720px; margin:auto; padding:15px; }

/* ===== Cards ===== */
.card { background:white; padding:15px; margin-bottom:15px; border-radius:12px; box-shadow:0 6px 15px rgba(0,0,0,0.08); transition:0.3s; }
.card:hover { box-shadow:0 8px 20px rgba(0,0,0,0.12); transform:translateY(-2px); }

/* ===== Inputs ===== */
input, select, textarea { width:100%; padding:12px; margin:6px 0 12px 0; border-radius:8px; border:1px solid #ccc; font-size:14px; }
textarea { resize:none; }

/* ===== Buttons ===== */
button { background:linear-gradient(45deg,#fc8019,#ffb347); color:white; border:none; padding:12px; border-radius:10px; font-size:16px; cursor:pointer; transition:0.3s; width:100%; }
button:hover { opacity:0.9; transform:translateY(-2px); }

/* ===== Profile ===== */
.profile-img { width:80px; height:80px; border-radius:50%; margin-bottom:10px; object-fit:cover; }

/* ===== Product Cards ===== */
.product-card { display:flex; align-items:center; margin-bottom:12px; padding:10px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); transition:0.3s; background:white; }
.product-card:hover { box-shadow:0 8px 20px rgba(0,0,0,0.12); transform:translateY(-3px); }
.product-card img { width:80px; height:80px; border-radius:12px; object-fit:cover; margin-right:12px; }
.product-details { flex:1; }

/* ===== Category Tabs ===== */
.category-tabs { display:flex; overflow-x:auto; margin-bottom:15px; }
.category-tabs button { margin-right:10px; flex:none; min-width:120px; font-size:14px; }

/* ===== Cart ===== */
.cart-summary { position:fixed; bottom:20px; right:20px; background:white; padding:15px; border-radius:12px; box-shadow:0 6px 15px rgba(0,0,0,0.15); width:250px; transition:0.3s; display:none; }
.cart-summary.show { transform:translateY(0); opacity:1; }

/* ===== Help Desk ===== */
.help-msg { background:#fff4e6; padding:10px; border-radius:10px; margin-bottom:10px; box-shadow:0 2px 8px rgba(0,0,0,0.05); animation:fadeIn 0.5s ease; }

/* ===== Animations ===== */
@keyframes fadeIn { 0% {opacity:0; transform:translateY(10px);} 100% {opacity:1; transform:translateY(0);} }
</style>
</head>

<body>
<header>SR FOOD'S</header>
<div class="container">

  <!-- Profile Card -->
  <div class="card" id="profileCard" style="display:none; text-align:center;">
    <img id="profilePic" src="" class="profile-img">
    <h3 id="profileName"></h3>
    <p id="profileEmail"></p>
    <button onclick="logout()" style="background:#ff4d4d;">Logout</button>
  </div>

  <!-- Login / Register -->
  <div class="card" id="loginCard">
    <h3>Welcome</h3>
    <button onclick="googleLogin()" style="background:#4285F4;">Login with Google</button>
    <hr style="margin:12px 0;">
    <input type="email" id="emailLogin" placeholder="Enter Email">
    <input type="password" id="passwordLogin" placeholder="Enter Password">
    <button onclick="emailLogin()">Login with Email</button>
    <button onclick="emailRegister()">Register</button>
  </div>

  <!-- New Customer Details -->
  <div class="card" id="customerCard" style="display:none;">
    <h3>Customer Details</h3>
    <input type="text" id="custName" placeholder="Full Name">
    <input type="text" id="custPhone" placeholder="+91XXXXXXXXXX">
    <input type="text" id="custDoor" placeholder="Door / House Number">
    <input type="text" id="custStreet" placeholder="Street / Landmark">
    <input type="text" id="custVillage" placeholder="Village / Locality">
    <input type="text" id="custPincode" placeholder="PIN Code">
    <input type="text" id="custDistrict" placeholder="District">
    <input type="text" id="custCity" placeholder="City">
    <input type="text" id="custState" placeholder="State">
    <button onclick="saveCustomerDetails()">Save Details</button>
  </div>

  <!-- Category Tabs -->
  <div class="category-tabs" id="categoryTabs" style="display:none;">
    <button onclick="filterCategory('veg')">Veg Pickles</button>
    <button onclick="filterCategory('nonveg')">Non-Veg Pickles</button>
    <button onclick="filterCategory('sweets')">Sweets</button>
    <button onclick="filterCategory('chikkis')">Chikkis</button>
    <button onclick="filterCategory('specials')">SR Specials</button>
  </div>

  <!-- Products -->
  <div class="card" id="productsCard" style="display:none;"></div>

  <!-- Place Order -->
  <div class="card" id="orderCard" style="display:none;">
    <h3>Place Order</h3>
    <label>Select Delivery Location</label>
    <select id="location">
      <option value="local">Ravulapalem</option>
      <option value="district">District</option>
      <option value="state">Andhra Pradesh</option>
      <option value="otherState">Other State</option>
    </select>
    <button onclick="payNow()">Pay Now</button>
    <p id="totalText"></p>
  </div>

  <!-- Customer Help Desk -->
  <div class="card" id="helpDeskCard" style="display:none;">
    <h3>Customer Help Desk</h3>
    <textarea id="helpMessage" placeholder="Write your query..." rows="4"></textarea>
    <button onclick="sendHelpMessage()">Send Message</button>
    <div id="helpMessages"></div>
  </div>

</div>

<!-- Cart Summary -->
<div class="cart-summary" id="cartSummary">
  <h4>Cart</h4>
  <div id="cartItems"></div>
  <p id="cartTotal"></p>
</div>

<script>
  // Firebase Init
  firebase.initializeApp({
    apiKey: "AIzaSyCHg-gxVV-vuALSZgcGBabChPZnznTlySg",
    authDomain: "sr-food-wonders-demo.firebaseapp.com",
    projectId: "sr-food-wonders-demo",
    storageBucket: "sr-food-wonders-demo.firebasestorage.app",
    messagingSenderId: "895619294540",
    appId: "1:895619294540:web:72cee3f5756daa116b1be9"
  });
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Profile Display
  function showProfile(user){
    document.getElementById("profileCard").style.display="block";
    document.getElementById("profileName").innerText = user.displayName || document.getElementById("custName").value;
    document.getElementById("profileEmail").innerText = user.email;
    document.getElementById("profilePic").src = user.photoURL || "https://via.placeholder.com/80";
  }

  // Login/Register
  function googleLogin(){
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(result=>{
      const user = result.user;
      document.getElementById("loginCard").style.display="none";
      showProfile(user);
      checkCustomerExists(user);
    });
  }
  function emailLogin(){
    const email = document.getElementById("emailLogin").value;
    const password = document.getElementById("passwordLogin").value;
    auth.signInWithEmailAndPassword(email,password)
      .then(result=>{
        const user = result.user;
        document.getElementById("loginCard").style.display="none";
        showProfile(user);
        checkCustomerExists(user);
      }).catch(err=>alert(err.message));
  }
  function emailRegister(){
    const email = document.getElementById("emailLogin").value;
    const password = document.getElementById("passwordLogin").value;
    auth.createUserWithEmailAndPassword(email,password)
      .then(()=>alert("Registration successful! Please login now."))
      .catch(err=>alert(err.message));
  }

  // Logout
  function logout(){
    auth.signOut().then(()=>{
      document.getElementById("profileCard").style.display="none";
      document.getElementById("customerCard").style.display="none";
      document.getElementById("productsCard").style.display="none";
      document.getElementById("orderCard").style.display="none";
      document.getElementById("helpDeskCard").style.display="none";
      document.getElementById("cartSummary").style.display="none";
      document.getElementById("loginCard").style.display="block";
    });
  }

  // Check if customer exists
  function checkCustomerExists(user){
    db.collection('users').doc(user.uid).get().then(doc=>{
      if(doc.exists){
        showShop();
      } else {
        document.getElementById("customerCard").style.display="block";
      }
    });
  }

  // Save Customer Details
  function saveCustomerDetails(){
    const user = auth.currentUser;
    if(!user){ alert("Login first"); return; }
    const data = {
      name: document.getElementById("custName").value,
      phone: document.getElementById("custPhone").value,
      address:{
        door: document.getElementById("custDoor").value,
        street: document.getElementById("custStreet").value,
        village: document.getElementById("custVillage").value,
        pincode: document.getElementById("custPincode").value,
        district: document.getElementById("custDistrict").value,
        city: document.getElementById("custCity").value,
        state: document.getElementById("custState").value
      },
      email: user.email,
      profilePic: user.photoURL
    };
    db.collection('users').doc(user.uid).set(data,{merge:true})
      .then(()=>{
        alert("Details saved! Proceed to shop.");
        document.getElementById("customerCard").style.display="none";
        showShop();
      }).catch(err=>alert(err.message));
  }

  // Products & Shop
  let cart=[];
  const products=[
    {name:"Chicken Boneless Pickle", price:900, img:"https://via.placeholder.com/80", category:"nonveg"},
    {name:"Mutton Boneless Pickle", price:1650, img:"https://via.placeholder.com/80", category:"nonveg"},
    {name:"Small Prawn Pickle", price:600, img:"https://via.placeholder.com/80", category:"nonveg"},
    {name:"Veg Pickle", price:400, img:"https://via.placeholder.com/80", category:"veg"},
    {name:"Chikki Special", price:350, img:"https://via.placeholder.com/80", category:"chikkis"}
  ];

  function showShop(){
    document.getElementById("categoryTabs").style.display="flex";
    document.getElementById("productsCard").style.display="block";
    document.getElementById("orderCard").style.display="block";
    document.getElementById("helpDeskCard").style.display="block";
    renderProducts("all");
  }

  function renderProducts(cat){
    const container=document.getElementById("productsCard");
    container.innerHTML="";
    products.forEach(p=>{
      if(cat==="all"||cat===p.category){
        const div=document.createElement("div");
        div.className="product-card";
        div.innerHTML=`<img src="${p.img}">
          <div class="product-details">
            <h4>${p.name}</h4>
            <p>₹${p.price}</p>
            <input type="number" min="1" value="1" class="productQty" data-price="${p.price}">
            <button onclick="addToCart('${p.name}',${p.price},this)">Add to Cart</button>
          </div>`;
        container.appendChild(div);
      }
    });
  }

  function filterCategory(cat){ renderProducts(cat); }

  function addToCart(name,price,btn){
    const qty=Number(btn.parentElement.querySelector(".productQty").value);
    cart.push({name,price,qty});
    updateCartSummary();
    alert(name+" added to cart!");
  }

  function updateCartSummary(){
    const summary=document.getElementById("cartSummary");
    summary.style.display="block";
    const container=document.getElementById("cartItems");
    container.innerHTML="";
    let total=0;
    cart.forEach(item=>{
      container.innerHTML+=`<p>${item.name} x ${item.qty} = ₹${item.price*item.qty}</p>`;
      total+=item.price*item.qty;
    });
    document.getElementById("cartTotal").innerText="Total: ₹"+total;
  }

  // Payment
  async function payNow(){
    if(cart.length===0){ alert("Add products to cart"); return; }
    const location=document.getElementById("location").value;
    const doc=await db.collection("settings").doc("shipping").get();
    const shipping=doc.exists?doc.data()[location]||0:0;
    let total=0; cart.forEach(item=>total+=item.price*item.qty);
    total+=shipping;
    document.getElementById("totalText").innerText="Products + Shipping = ₹"+total;

    var options={key:"rzp_live_SI5VMj6l9U45sn", amount:total*100, currency:"INR",
      name:"SR FOOD'S", description:"Food Order Payment",
      handler:function(response){
        alert("Payment Success! Payment ID: "+response.razorpay_payment_id);
        saveOrder(response.razorpay_payment_id);
      },
      theme:{color:"#fc8019"}
    };
    new Razorpay(options).open();
  }

  function saveOrder(paymentId){
    const user=auth.currentUser;
    db.collection("orders").add({
      userId:user.uid,
      cart:cart,
      location:document.getElementById("location").value,
      paymentId:paymentId,
      timestamp:firebase.firestore.FieldValue.serverTimestamp(),
      status:"pending"
    }).then(()=>{alert("Order saved!"); cart=[]; updateCartSummary();});
  }

  // Help Desk
  function sendHelpMessage(){
    const msg=document.getElementById("helpMessage").value;
    const user=auth.currentUser;
    if(!msg || !user){ alert("Login and enter message"); return; }
    db.collection("helpdesk").add({userId:user.uid,message:msg,timestamp:firebase.firestore.FieldValue.serverTimestamp(),status:"pending"})
      .then(()=>{alert("Message sent!"); document.getElementById("helpMessage").value="";});
  }

</script>
</body>
</html>
